{% extends 'base.html'%}
{% block content %}

<section>
    <div class="section-title">
        <h2>Admin Dashboard</h2>
        <p>Manage your shop, products, offers, and categories from a single dashboard</p>
    </div>
    <div class="dashboard-stats">
        <div class="stat-card">
            <i class="fas fa-store"></i>
            <h3>{{ total_shops|default(0) }}</h3>
            <p>Total Shops</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-box"></i>
            <h3>{{ total_products|default(0) }}</h3>
            <p>Total Products</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-tags"></i>
            <h3>{{ total_offers|default(0) }}</h3>
            <p>Active Offers</p>
        </div>
        <div class="stat-card">
            <i class="fas fa-chart-line"></i>
            <h3>₹0</h3>
            <p>Total Revenue</p>
        </div>
    </div>

    <div class="dashboard">
        <div class="dashboard-header">
            <h3>Overview</h3>
            <a href="{{url_for('home')}}" class="btn btn-light" style="text-decoration: none;">Logout</a>
        </div>

        <!-- Overview Tab -->
        <div class="tab-content" id="overview-tab">
            <h4>Welcome to Your Dashboard</h4>
            <p>Manage your shop, products, and offers from this centralized dashboard. Select a tab to get started.
            </p>

            <div class="features" style="margin-top: 2rem;">
                <div class="feature-card" style="text-align: left;">
                    <div class="feature-icon">
                        <i class="fas fa-store"></i>
                    </div>
                    <h3>Setup Your Shop</h3>
                    <p>Add your shop details, description, and contact information to get started.</p>
                    <button class="btn btn-primary tab" style="margin-top: 1rem;" data-tab="shop">Setup Shop</button>
                </div>
                <div class="feature-card" style="text-align: left;">
                    <div class="feature-icon">
                        <i class="fas fa-box"></i>
                    </div>
                    <h3>Add Products</h3>
                    <p>Start adding your products with images, descriptions, and pricing.</p>
                    <button class="btn btn-primary tab" style="margin-top: 1rem;" data-tab="products">Add
                        Products</button>
                </div>
                <div class="feature-card" style="text-align: left;">
                    <div class="feature-icon">
                        <i class="fas fa-tags"></i>
                    </div>
                    <h3>Create Offers</h3>
                    <p>Attract more customers with special offers, discounts, and promotions.</p>
                    <button class="btn btn-primary tab" style="margin-top: 1rem;" data-tab="offers">Create Offers</button>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard">
        <div class="dashboard-header">
            <h3>Shop Details</h3>
        </div>
        <!-- Shop Details Tab -->
        <div class="tab-content" id="shop-tab">
            <h4>Create/Update Shop Details</h4>
            <form id="shopForm" action="{{ url_for('addshop') }}" method="POST">
                <input type="hidden" id="shopId" name="shopId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="shopName">Shop Name *</label>
                        <input type="text" id="shopName" name="shopName" class="form-control" placeholder="Enter shop name" required>
                    </div>
                    <div class="form-group">
                        <label for="shopCategory">Category *</label>
                        <select id="shopCategory" name="shopCategory" class="form-control" required>
                            <option value="">Select Category</option>
                            <option value="clothing">Clothing & Fashion</option>
                            <option value="electronics">Electronics</option>
                            <option value="food">Food & Beverages</option>
                            <option value="handicrafts">Handicrafts</option>
                            <option value="home">Home & Kitchen</option>
                            <option value="beauty">Beauty & Personal Care</option>
                            <option value="sports">Sports & Outdoors</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="shopFloor">Floor *</label>
                        <select id="shopFloor" name="shopFloor" class="form-control" required>
                            <option value="">Select Floor</option>
                            <option value="ground">Ground Floor</option>
                            <option value="first">First Floor</option>
                            <option value="second">Second Floor</option>
                            <option value="third">Third Floor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="shopContact">Contact Number *</label>
                        <input type="text" id="shopContact" name="shopContact" class="form-control" placeholder="Enter contact number"
                            required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="shopDescription">Shop Description *</label>
                    <textarea id="shopDescription" name="shopDescription" class="form-control" rows="4"
                        placeholder="Describe your shop and products" required></textarea>
                </div>
                <div class="form-group">
                    <label for="shopAddress">Shop Address</label>
                    <textarea id="shopAddress" name="shopAddress" class="form-control" rows="2"
                        placeholder="Enter your shop address"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Save Shop Details
                </button>
            </form>

            <div id="shopList" style="margin-top: 2rem;">
                <h5>Your Shops</h5>
                <div class="data-table">
                    <table style="width: 100%; table-layout: fixed; border-collapse: collapse; border: 2px solid #333; margin: 0 auto;">
                        <thead>
                            <tr>
                                <th style="width: 25%; border: 1px solid #333; padding: 10px; background-color: #f8f9fa; font-weight: bold; text-align: center;">Shop Name</th>
                                <th style="width: 20%; border: 1px solid #333; padding: 10px; background-color: #f8f9fa; font-weight: bold; text-align: center;">Category</th>
                                <th style="width: 15%; border: 1px solid #333; padding: 10px; background-color: #f8f9fa; font-weight: bold; text-align: center;">Floor</th>
                                <th style="width: 20%; border: 1px solid #333; padding: 10px; background-color: #f8f9fa; font-weight: bold; text-align: center;">Contact</th>
                                <th style="width: 20%; border: 1px solid #333; padding: 10px; background-color: #f8f9fa; font-weight: bold; text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="shopTableBody" style="text-align: center;">
                            {% for shop in shops %}
                            <tr>
                                <td>{{ shop.name }}</td>
                                <td>{{ shop.category }}</td>
                                <td>{{ shop.floor }}</td>
                                <td>{{ shop.contact }}</td>
                                <td>
                                    <button class="btn btn-accent" data-shop-id="{{ shop.id }}" onclick="deleteShop(this)">Delete</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard">
        <div class="dashboard-header">
            <h3>Manage Offers</h3>
        </div>
        <!-- Offers Tab -->
        <div class="tab-content" id="offers-tab">
            <h4>Manage Offers & Promotions</h4>
            <form id="offerForm" action="{{ url_for('addoffer') }}" method="POST">
                <input type="hidden" id="offerId" name="offerId">
                <div class="form-row">
                    <div class="form-group">
                        <label for="offerTitle">Offer Title *</label>
                        <input type="text" id="offerTitle" name="offerTitle" class="form-control"
                            placeholder="e.g., Summer Sale, Diwali Discount" required>
                    </div>
                    <div class="form-group">
                        <label for="offerDiscount">Discount (%) *</label>
                        <input type="number" id="offerDiscount" name="offerDiscount" class="form-control"
                            placeholder="Enter discount percentage" min="1" max="100" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="offerDescription">Offer Description *</label>
                    <textarea id="offerDescription" name="offerDescription" class="form-control" rows="3"
                        placeholder="Describe the offer details" required></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="offerStart">Start Date *</label>
                        <input type="date" id="offerStart" name="offerStart" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="offerEnd">End Date *</label>
                        <input type="date" id="offerEnd" name="offerEnd" class="form-control" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="offerProducts">Applicable Products</label>
                    <select id="offerProducts" name="offerProducts" class="form-control" multiple>
                        <!-- Product options will be populated here -->
                    </select>
                    <small>Hold Ctrl to select multiple products</small>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-tag"></i> Create Offer
                </button>
            </form>

            <div id="offersList" style="margin-top: 2rem;">
                <h5>Active Offers</h5>
                <div class="data-table">
                    <table style="width: 100%; table-layout: fixed; border-collapse: collapse; border: 2px solid #333; margin: 0 auto;">
                        <thead>
                            <tr>
                                <th style="width: 25%; border: 1px solid #333; padding: 10px; background-color: #f8f9fa; font-weight: bold; text-align: center;">Offer Title</th>
                                <th style="width: 20%; border: 1px solid #333; padding: 10px; background-color: #f8f9fa; font-weight: bold; text-align: center;">Discount</th>
                                <th style="width: 15%; border: 1px solid #333; padding: 10px; background-color: #f8f9fa; font-weight: bold; text-align: center;">Status</th>
                                <th style="width: 40%; border: 1px solid #333; padding: 10px; background-color: #f8f9fa; font-weight: bold; text-align: center;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="offersTableBody" style="text-align: center;">
                            {% for offer in offers %}
                            <tr>
                                <td>{{ offer.title }}</td>
                                <td>{{ offer.discount }}%</td>
                                <td>
                                    <span class="badge badge-success">Active</span>
                                </td>
                                <td>
                                    <button class="btn btn-accent" data-offer-id="{{ offer.id }}" onclick="deleteOffer(this)">Delete</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard">
        <div class="dashboard-header">
            <h3>Categories and Floors</h3>
        </div>
        <!-- Categories & Floors Tab -->
        <div class="tab-content" id="categories-tab">
            <h4>Manage Categories & Floors</h4>
            <div class="form-row">
                <div class="form-group">
                    <label for="newCategory">Add New Category</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newCategory" class="form-control" placeholder="Enter category name">
                        <button class="btn btn-primary" id="addCategoryBtn">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="newFloor">Add New Floor</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="newFloor" class="form-control" placeholder="Enter floor name">
                        <button class="btn btn-primary" id="addFloorBtn">
                            <i class="fas fa-plus"></i> Add
                        </button>
                    </div>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                <div>
                    <h5>Existing Categories</h5>
                    <ul class="footer-links" id="categoriesList">
                        {% for category in categories %}
                        <li>
                            {{ category.name }}
                            <button class="btn btn-sm btn-accent" onclick="deleteCategory('{{ category.name }}')" style="float: right;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                <div>
                    <h5>Existing Floors</h5>
                    <ul class="footer-links" id="floorsList">
                        {% for floor in floors %}
                        <li>
                            {{ floor.name }}
                            <button class="btn btn-sm btn-accent" onclick="deleteFloor('{{ floor.name }}')" style="float: right;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard">
        <div class="dashboard-header">
            <h3>Products</h3>
        </div>
        <!-- Products Tab -->
        <div class="tab-content" id="products-tab">
            <h4>Manage Products</h4>
            <button class="btn btn-primary" style="margin-bottom: 1.5rem;" id="addProductBtn">
                <i class="fas fa-plus"></i> Add New Product
            </button>

            <div id="productFormContainer"
                style="display: none; background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-bottom: 2rem;">
                <h5 id="productFormTitle">Add New Product</h5>
                <form id="productForm" action="{{ url_for('addproduct') }}" method="POST">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productName">Product Name *</label>
                            <input type="text" id="productName" name="productName" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="productPrice">Price (₹) *</label>
                            <input type="number" id="productPrice" name="productPrice" class="form-control" min="0" step="0.01" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productCategory">Category *</label>
                            <select id="productCategory" name="productCategory" class="form-control" required>
                                {% for category in categories %}
                                <option value="{{ category.name }}">{{ category.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productShop">Shop *</label>
                            <select id="productShop" name="productShop" class="form-control" required>
                                {% for shop in shops %}
                                <option value="{{ shop.name }}">{{ shop.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="productDescription">Product Description *</label>
                        <textarea id="productDescription" name="productDescription" class="form-control" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="productFeatures">Key Features (one per line)</label>
                        <textarea id="productFeatures" name="productFeatures" class="form-control" rows="3"
                            placeholder="Enter each feature on a new line"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="productImage">Product Image URL</label>
                            <input type="url" id="productImage" name="productImage" class="form-control"
                                placeholder="https://example.com/image.jpg">
                        </div>
                        <div class="form-group">
                            <label for="productStock">Stock Quantity</label>
                            <input type="number" id="productStock" name="productStock" class="form-control" min="0" value="1">
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="submit" class="btn btn-primary" id="saveProductBtn">
                            <i class="fas fa-save"></i> Save Product
                        </button>
                        <button type="button" class="btn btn-secondary" id="cancelProductBtn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </form>
            </div>

            <div class="products-grid" id="adminProductsGrid">
                <!-- Admin products will be populated here -->
            </div>
        </div>
    </div>

    <div class="dashboard">
        <div class="dashboard-header">
            <h3>Analytics</h3>
        </div>
        <!-- Analytics Tab -->
        <div class="tab-content" id="analytics-tab">
            <h4>Shop Analytics</h4>
            <p>Track your shop performance and customer engagement.</p>

            <div class="dashboard-stats">
                <div class="stat-card">
                    <i class="fas fa-eye"></i>
                    <h3>1,254</h3>
                    <p>Product Views</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>89</h3>
                    <p>Orders This Month</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-indian-rupee"></i>
                    <h3>₹2,458</h3>
                    <p>Revenue This Month</p>
                </div>
                <div class="stat-card">
                    <i class="fas fa-star"></i>
                    <h3>4.7</h3>
                    <p>Average Rating</p>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-top: 2rem;">
                <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: var(--shadow);">
                    <h5>Sales Overview</h5>
                    <p>Analytics dashboard coming soon. Track your sales performance, revenue trends, and customer insights in real-time.</p>
                </div>
                <div style="background: white; padding: 1.5rem; border-radius: 10px; box-shadow: var(--shadow);">
                    <h5>Top Products</h5>
                    <ul class="footer-links" style="margin-top: 1rem;">
                        <li>Handmade Cotton Shirt <span style="float: right; font-weight: 600;">42 sales</span></li>
                        <li>Wooden Phone Case <span style="float: right; font-weight: 600;">38 sales</span></li>
                        <li>Organic Honey Pack <span style="float: right; font-weight: 600;">35 sales</span></li>
                        <li>Silver Jewelry Set <span style="float: right; font-weight: 600;">28 sales</span></li>
                        <li>Handwoven Saree <span style="float: right; font-weight: 600;">25 sales</span></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>




<script>
    document.addEventListener("DOMContentLoaded", () => {
        // Tab functionality
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                switchTab(tabId);
            });
        });

        function switchTab(tabId) {
            tabs.forEach(t => t.classList.remove('active'));
            document.querySelector('.tab[data-tab="' + tabId + '"]').classList.add('active');

            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === tabId + '-tab') {
                    content.classList.add('active');
                }
            });

            if (tabId === 'products') {
                renderProducts();
            }
        }

        // Product form toggle
        const addProductBtn = document.getElementById('addProductBtn');
        const productFormContainer = document.getElementById('productFormContainer');
        const cancelProductBtn = document.getElementById('cancelProductBtn');

        if (addProductBtn) {
            addProductBtn.addEventListener('click', () => {
                productFormContainer.style.display = 'block';
                document.getElementById('productFormTitle').textContent = 'Add New Product';
                document.getElementById('productForm').reset();
            });
        }

        if (cancelProductBtn) {
            cancelProductBtn.addEventListener('click', () => {
                productFormContainer.style.display = 'none';
            });
        }

        // Render products in admin view
        function renderProducts() {
            const productsGrid = document.getElementById('adminProductsGrid');
            if (!productsGrid) return;

            // This would be populated from server data
            productsGrid.innerHTML = `
                <div class="product-card">
                    <div class="product-badge">New</div>
                    <div class="product-image">
                        <i class="fas fa-box"></i>
                    </div>
                    <div class="product-content">
                        <h3 class="product-title">Sample Product</h3>
                        <div class="product-shop">
                            <i class="fas fa-store"></i> Sample Shop
                        </div>
                        <div class="product-price">₹999</div>
                        <div class="product-features">
                            <div class="product-feature">
                                <i class="fas fa-check"></i> Feature 1
                            </div>
                            <div class="product-feature">
                                <i class="fas fa-check"></i> Feature 2
                            </div>
                        </div>
                        <div class="product-actions">
                            <button class="btn btn-secondary">Edit</button>
                            <button class="btn btn-accent">Delete</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Tables are now populated directly with Jinja templates

        // Hide login/register buttons in admin view
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const navLinks = document.querySelectorAll('nav a');

        if (loginBtn) loginBtn.style.display = 'none';
        if (registerBtn) registerBtn.style.display = 'none';
        navLinks.forEach(link => {
            link.style.display = 'none';
        });
    });

    // Edit functions
    function editShop(id, name, category, floor, contact, description, address) {
        document.getElementById('shopId').value = id;
        document.getElementById('shopName').value = name;
        document.getElementById('shopCategory').value = category;
        document.getElementById('shopFloor').value = floor;
        document.getElementById('shopContact').value = contact;
        document.getElementById('shopDescription').value = description;
        document.getElementById('shopAddress').value = address;
        document.querySelector('#shop-tab button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> Update Shop Details';
        switchTab('shop');
    }

    function editOffer(id, title, discount, description, startDate, endDate) {
        document.getElementById('offerId').value = id;
        document.getElementById('offerTitle').value = title;
        document.getElementById('offerDiscount').value = discount;
        document.getElementById('offerDescription').value = description;
        document.getElementById('offerStart').value = startDate;
        document.getElementById('offerEnd').value = endDate;
        document.querySelector('#offers-tab button[type="submit"]').innerHTML = '<i class="fas fa-tag"></i> Update Offer';
        switchTab('offers');
    }

    // Delete functions
    function deleteShop(button) {
        const shopId = button.getAttribute('data-shop-id');
        if (confirm('Are you sure you want to delete this shop?')) {
            window.location.href = `/delete_shop/${shopId}`;
        }
    }

    function deleteProduct(productId) {
        if (confirm('Are you sure you want to delete this product?')) {
            window.location.href = `/delete_product/${productId}`;
        }
    }

    function deleteOffer(button) {
        const offerId = button.getAttribute('data-offer-id');
        if (confirm('Are you sure you want to delete this offer?')) {
            window.location.href = `/delete_offer/${offerId}`;
        }
    }

    function deleteCategory(categoryName) {
        if (confirm('Are you sure you want to delete this category?')) {
            window.location.href = `/delete_category/${encodeURIComponent(categoryName)}`;
        }
    }

    function deleteFloor(floorName) {
        if (confirm('Are you sure you want to delete this floor?')) {
            window.location.href = `/delete_floor/${encodeURIComponent(floorName)}`;
        }
    }
</script>

{% endblock %}
